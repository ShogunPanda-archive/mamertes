<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Mamertes::Parser
  
    &mdash; Documentation by YARD 0.8.2.1
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Mamertes.html" title="Mamertes (module)">Mamertes</a></span></span>
     &raquo; 
    <span class="title">Parser</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Mamertes::Parser
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Mamertes::Parser</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/mamertes/parser.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>The parser for the command line.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_command-class_method" title="find_command (class method)">+ (Hash|NilClass) <strong>find_command</strong>(arg, command, args, separator = &quot;:&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Finds a command which corresponds to an argument.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse-class_method" title="parse (class method)">+ (Hash|NilClass) <strong>parse</strong>(command, args) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Parses a command/application.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#smart_join-class_method" title="smart_join (class method)">+ (String) <strong>smart_join</strong>(array, separator = &quot;, &quot;, last_separator = &quot; and &quot;, quote = &quot;\&quot;&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Joins an array using multiple separators.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="find_command-class_method">
  
    + (<tt>Hash|NilClass</tt>) <strong>find_command</strong>(arg, command, args, separator = &quot;:&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Finds a command which corresponds to an argument.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>arg</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The string to match.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>command</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Command.html" title="Mamertes::Command (class)">Command</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The command to search subcommand in.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The complet list of arguments passed.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>separator</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;:&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The separator for joined syntax commands.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash|NilClass</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>An hash with <code>name</code> and <code>args</code> keys if a valid subcommand is found, <code>nil</code> otherwise.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mamertes/parser.rb', line 38</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_find_command identifier id'>find_command</span><span class='lparen token'>(</span><span class='rubyid_arg identifier id'>arg</span><span class='comma token'>,</span> <span class='rubyid_command identifier id'>command</span><span class='comma token'>,</span> <span class='rubyid_args identifier id'>args</span><span class='comma token'>,</span> <span class='rubyid_separator identifier id'>separator</span> <span class='assign token'>=</span> <span class='string val'>&quot;:&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_args identifier id'>args</span> <span class='assign token'>=</span> <span class='rubyid_args identifier id'>args</span><span class='dot token'>.</span><span class='rubyid_ensure_array identifier id'>ensure_array</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
  <span class='rubyid_rv identifier id'>rv</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_command identifier id'>command</span><span class='dot token'>.</span><span class='rubyid_commands identifier id'>commands</span><span class='dot token'>.</span><span class='rubyid_present? fid id'>present?</span> <span class='rubyid_then then kw'>then</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_arg identifier id'>arg</span><span class='dot token'>.</span><span class='rubyid_index identifier id'>index</span><span class='lparen token'>(</span><span class='rubyid_separator identifier id'>separator</span><span class='rparen token'>)</span> <span class='rubyid_then then kw'>then</span>
      <span class='rubyid_tokens identifier id'>tokens</span> <span class='assign token'>=</span> <span class='rubyid_arg identifier id'>arg</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='rubyid_separator identifier id'>separator</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
      <span class='rubyid_arg identifier id'>arg</span> <span class='assign token'>=</span> <span class='rubyid_tokens identifier id'>tokens</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
      <span class='rubyid_args identifier id'>args</span><span class='dot token'>.</span><span class='rubyid_insert identifier id'>insert</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='rubyid_tokens identifier id'>tokens</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_matching identifier id'>matching</span> <span class='assign token'>=</span> <span class='rubyid_command identifier id'>command</span><span class='dot token'>.</span><span class='rubyid_commands identifier id'>commands</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_c identifier id'>c</span><span class='bitor op'>|</span> <span class='rubyid_c identifier id'>c</span> <span class='match op'>=~</span> <span class='dregexp node'>/^(#{Regexp.quote(arg)})/</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_compact identifier id'>compact</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_matching identifier id'>matching</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>1</span> <span class='comment val'># Found a command</span>
      <span class='rubyid_rv identifier id'>rv</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_matching identifier id'>matching</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:args</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_args identifier id'>args</span><span class='rbrace token'>}</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_matching identifier id'>matching</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span> <span class='comment val'># Ambiguous match</span>
      <span class='rubyid_raise identifier id'>raise</span> <span class='colon3 op'>::</span><span class='rubyid_Mamertes constant id'>Mamertes</span><span class='colon2 op'>::</span><span class='rubyid_Error constant id'>Error</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_command identifier id'>command</span><span class='comma token'>,</span> <span class='symbol val'>:ambiguous_command</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Command shortcut \&quot;#{arg}\&quot; is ambiguous across commands #{::Mamertes::Parser.smart_join(matching)}. Please add some other characters.&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_rv identifier id'>rv</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse-class_method">
  
    + (<tt>Hash|NilClass</tt>) <strong>parse</strong>(command, args) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Parses a command/application.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>command</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Command.html" title="Mamertes::Command (class)">Command</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The command or application to parse.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The arguments to parse.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash|NilClass</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>An hash with <code>name</code> (of a subcommand to execute) and <code>args</code> keys if a valid subcommand is found, <code>nil</code> otherwise.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mamertes/parser.rb', line 65</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_parse identifier id'>parse</span><span class='lparen token'>(</span><span class='rubyid_command identifier id'>command</span><span class='comma token'>,</span> <span class='rubyid_args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='rubyid_rv identifier id'>rv</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_args identifier id'>args</span> <span class='assign token'>=</span> <span class='rubyid_args identifier id'>args</span><span class='dot token'>.</span><span class='rubyid_ensure_array identifier id'>ensure_array</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
  <span class='rubyid_forms identifier id'>forms</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

  <span class='rubyid_parser identifier id'>parser</span> <span class='assign token'>=</span> <span class='rubyid_OptionParser constant id'>OptionParser</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_opts identifier id'>opts</span><span class='bitor op'>|</span>
    <span class='comment val'># Add every option</span>
    <span class='rubyid_command identifier id'>command</span><span class='dot token'>.</span><span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_each_pair identifier id'>each_pair</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_option identifier id'>option</span><span class='bitor op'>|</span>
      <span class='comment val'># Check that the option is unique</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_forms identifier id'>forms</span><span class='lbrack token'>[</span><span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_complete_short identifier id'>complete_short</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_forms identifier id'>forms</span><span class='lbrack token'>[</span><span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_complete_long identifier id'>complete_long</span><span class='rbrack token'>]</span> <span class='rubyid_then then kw'>then</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='colon3 op'>::</span><span class='rubyid_Mamertes constant id'>Mamertes</span><span class='colon2 op'>::</span><span class='rubyid_Error constant id'>Error</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_command identifier id'>command</span><span class='comma token'>,</span> <span class='symbol val'>:ambiguous_form</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Options #{option.label} and #{forms[option.complete_short].label} have conflicting forms.&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_forms identifier id'>forms</span><span class='lbrack token'>[</span><span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_complete_short identifier id'>complete_short</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
        <span class='rubyid_forms identifier id'>forms</span><span class='lbrack token'>[</span><span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_complete_long identifier id'>complete_long</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_dup identifier id'>dup</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_if if kw'>if</span> <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_action identifier id'>action</span><span class='dot token'>.</span><span class='rubyid_present? fid id'>present?</span> <span class='rubyid_then then kw'>then</span>
        <span class='rubyid_opts identifier id'>opts</span><span class='dot token'>.</span><span class='rubyid_on identifier id'>on</span><span class='lparen token'>(</span><span class='dstring node'>&quot;-#{option.short}&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;--#{option.long}&quot;</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
          <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_execute_action identifier id'>execute_action</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_type identifier id'>type</span> <span class='eq op'>==</span> <span class='rubyid_String constant id'>String</span> <span class='rubyid_then then kw'>then</span> <span class='comment val'># String arguments</span>
        <span class='rubyid_opts identifier id'>opts</span><span class='dot token'>.</span><span class='rubyid_on identifier id'>on</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{option.complete_short} #{option.meta || &quot;ARG&quot;}&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{option.complete_long} #{option.meta || &quot;ARG&quot;}&quot;</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
          <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_set identifier id'>set</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_type identifier id'>type</span> <span class='eq op'>==</span> <span class='rubyid_Integer constant id'>Integer</span> <span class='rubyid_then then kw'>then</span> <span class='comment val'># Integer arguments</span>
        <span class='rubyid_opts identifier id'>opts</span><span class='dot token'>.</span><span class='rubyid_on identifier id'>on</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{option.complete_short} #{option.meta || &quot;ARG&quot;}&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{option.complete_long} #{option.meta || &quot;ARG&quot;}&quot;</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
          <span class='rubyid_raise identifier id'>raise</span> <span class='colon3 op'>::</span><span class='rubyid_Mamertes constant id'>Mamertes</span><span class='colon2 op'>::</span><span class='rubyid_Error constant id'>Error</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_option identifier id'>option</span><span class='comma token'>,</span> <span class='symbol val'>:invalid_argument</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Option #{option.label} expects a valid integer as argument.&quot;</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_is_integer? fid id'>is_integer?</span>
          <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_set identifier id'>set</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_integer identifier id'>to_integer</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_type identifier id'>type</span> <span class='eq op'>==</span> <span class='rubyid_Float constant id'>Float</span> <span class='rubyid_then then kw'>then</span> <span class='comment val'># Floating point arguments</span>
        <span class='rubyid_opts identifier id'>opts</span><span class='dot token'>.</span><span class='rubyid_on identifier id'>on</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{option.complete_short} #{option.meta || &quot;ARG&quot;}&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{option.complete_long} #{option.meta || &quot;ARG&quot;}&quot;</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
          <span class='rubyid_raise identifier id'>raise</span> <span class='colon3 op'>::</span><span class='rubyid_Mamertes constant id'>Mamertes</span><span class='colon2 op'>::</span><span class='rubyid_Error constant id'>Error</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_option identifier id'>option</span><span class='comma token'>,</span> <span class='symbol val'>:invalid_argument</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Option #{option.label} expects a valid floating number as argument.&quot;</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='notop op'>!</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_is_float? fid id'>is_float?</span>
          <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_set identifier id'>set</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_float identifier id'>to_float</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_type identifier id'>type</span> <span class='eq op'>==</span> <span class='rubyid_Array constant id'>Array</span> <span class='rubyid_then then kw'>then</span> <span class='comment val'># Array/List arguments</span>
        <span class='rubyid_opts identifier id'>opts</span><span class='dot token'>.</span><span class='rubyid_on identifier id'>on</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{option.complete_short} #{option.meta || &quot;ARG&quot;}&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{option.complete_long} #{option.meta || &quot;ARG&quot;}&quot;</span><span class='comma token'>,</span> <span class='rubyid_Array constant id'>Array</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
          <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_set identifier id'>set</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_ensure_array identifier id'>ensure_array</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_else else kw'>else</span> <span class='comment val'># Boolean (argument-less) type by default</span>
        <span class='rubyid_opts identifier id'>opts</span><span class='dot token'>.</span><span class='rubyid_on identifier id'>on</span><span class='lparen token'>(</span><span class='dstring node'>&quot;-#{option.short}&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;--#{option.long}&quot;</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_value identifier id'>value</span><span class='bitor op'>|</span>
          <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_set identifier id'>set</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_to_boolean identifier id'>to_boolean</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_begin begin kw'>begin</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_command identifier id'>command</span><span class='dot token'>.</span><span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_present? fid id'>present?</span> <span class='rubyid_then then kw'>then</span>
      <span class='comment val'># Parse options</span>
      <span class='rubyid_parser identifier id'>parser</span><span class='dot token'>.</span><span class='rubyid_order! fid id'>order!</span><span class='lparen token'>(</span><span class='rubyid_args identifier id'>args</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_arg identifier id'>arg</span><span class='bitor op'>|</span>
        <span class='rubyid_fc identifier id'>fc</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='rubyid_Mamertes constant id'>Mamertes</span><span class='colon2 op'>::</span><span class='rubyid_Parser constant id'>Parser</span><span class='dot token'>.</span><span class='rubyid_find_command identifier id'>find_command</span><span class='lparen token'>(</span><span class='rubyid_arg identifier id'>arg</span><span class='comma token'>,</span> <span class='rubyid_command identifier id'>command</span><span class='comma token'>,</span> <span class='rubyid_args identifier id'>args</span><span class='rparen token'>)</span>

        <span class='rubyid_if if kw'>if</span> <span class='rubyid_fc identifier id'>fc</span><span class='dot token'>.</span><span class='rubyid_present? fid id'>present?</span> <span class='rubyid_then then kw'>then</span>
          <span class='rubyid_rv identifier id'>rv</span> <span class='assign token'>=</span> <span class='rubyid_fc identifier id'>fc</span>
          <span class='rubyid_parser identifier id'>parser</span><span class='dot token'>.</span><span class='rubyid_terminate identifier id'>terminate</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='rubyid_command identifier id'>command</span><span class='dot token'>.</span><span class='rubyid_argument identifier id'>argument</span><span class='lparen token'>(</span><span class='rubyid_arg identifier id'>arg</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='comment val'># Check if any required option is missing.</span>
      <span class='rubyid_command identifier id'>command</span><span class='dot token'>.</span><span class='rubyid_options identifier id'>options</span><span class='dot token'>.</span><span class='rubyid_each_pair identifier id'>each_pair</span>  <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_option identifier id'>option</span><span class='bitor op'>|</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='colon3 op'>::</span><span class='rubyid_Mamertes constant id'>Mamertes</span><span class='colon2 op'>::</span><span class='rubyid_Error constant id'>Error</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_option identifier id'>option</span><span class='comma token'>,</span> <span class='symbol val'>:missing_option</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Required option #{option.label} is missing.&quot;</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_required identifier id'>required</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='rubyid_option identifier id'>option</span><span class='dot token'>.</span><span class='rubyid_provided? fid id'>provided?</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_args identifier id'>args</span><span class='dot token'>.</span><span class='rubyid_present? fid id'>present?</span> <span class='rubyid_then then kw'>then</span>
      <span class='comment val'># Try to find a command into the first argument</span>
      <span class='rubyid_fc identifier id'>fc</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='rubyid_Mamertes constant id'>Mamertes</span><span class='colon2 op'>::</span><span class='rubyid_Parser constant id'>Parser</span><span class='dot token'>.</span><span class='rubyid_find_command identifier id'>find_command</span><span class='lparen token'>(</span><span class='rubyid_args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_command identifier id'>command</span><span class='comma token'>,</span> <span class='rubyid_args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='rubyid_args identifier id'>args</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

      <span class='rubyid_if if kw'>if</span> <span class='rubyid_fc identifier id'>fc</span><span class='dot token'>.</span><span class='rubyid_present? fid id'>present?</span> <span class='rubyid_then then kw'>then</span>
        <span class='rubyid_rv identifier id'>rv</span> <span class='assign token'>=</span> <span class='rubyid_fc identifier id'>fc</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_args identifier id'>args</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_arg identifier id'>arg</span><span class='bitor op'>|</span>
          <span class='rubyid_command identifier id'>command</span><span class='dot token'>.</span><span class='rubyid_argument identifier id'>argument</span><span class='lparen token'>(</span><span class='rubyid_arg identifier id'>arg</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_OptionParser constant id'>OptionParser</span><span class='colon2 op'>::</span><span class='rubyid_MissingArgument constant id'>MissingArgument</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
    <span class='rubyid_option identifier id'>option</span> <span class='assign token'>=</span> <span class='rubyid_forms identifier id'>forms</span><span class='lbrack token'>[</span><span class='rubyid_e identifier id'>e</span><span class='dot token'>.</span><span class='rubyid_args identifier id'>args</span><span class='dot token'>.</span><span class='rubyid_first identifier id'>first</span><span class='rbrack token'>]</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='colon3 op'>::</span><span class='rubyid_Mamertes constant id'>Mamertes</span><span class='colon2 op'>::</span><span class='rubyid_Error constant id'>Error</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_option identifier id'>option</span><span class='comma token'>,</span> <span class='symbol val'>:missing_argument</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Option #{option.label} expects an argument.&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_OptionParser constant id'>OptionParser</span><span class='colon2 op'>::</span><span class='rubyid_InvalidOption constant id'>InvalidOption</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='colon3 op'>::</span><span class='rubyid_Mamertes constant id'>Mamertes</span><span class='colon2 op'>::</span><span class='rubyid_Error constant id'>Error</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_option identifier id'>option</span><span class='comma token'>,</span> <span class='symbol val'>:invalid_option</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Invalid option #{e.args}.&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_e identifier id'>e</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_rv identifier id'>rv</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="smart_join-class_method">
  
    + (<tt>String</tt>) <strong>smart_join</strong>(array, separator = &quot;, &quot;, last_separator = &quot; and &quot;, quote = &quot;\&quot;&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Joins an array using multiple separators.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>array</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The array to join.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>separator</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;, &quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The separator to use for all but last join.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>last_separator</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot; and &quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The separator to use for the last join.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>quote</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;\&quot;&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>If not nil, elements are quoted with that element.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The joined array.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19
20
21
22
23
24
25
26
27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/mamertes/parser.rb', line 17</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_smart_join identifier id'>smart_join</span><span class='lparen token'>(</span><span class='rubyid_array identifier id'>array</span><span class='comma token'>,</span> <span class='rubyid_separator identifier id'>separator</span> <span class='assign token'>=</span> <span class='string val'>&quot;, &quot;</span><span class='comma token'>,</span> <span class='rubyid_last_separator identifier id'>last_separator</span> <span class='assign token'>=</span> <span class='string val'>&quot; and &quot;</span><span class='comma token'>,</span> <span class='rubyid_quote identifier id'>quote</span> <span class='assign token'>=</span> <span class='string val'>&quot;\&quot;&quot;</span><span class='rparen token'>)</span>
  <span class='rubyid_array identifier id'>array</span> <span class='assign token'>=</span> <span class='rubyid_array identifier id'>array</span><span class='dot token'>.</span><span class='rubyid_ensure_array identifier id'>ensure_array</span>

  <span class='rubyid_array identifier id'>array</span> <span class='assign token'>=</span> <span class='rubyid_array identifier id'>array</span><span class='dot token'>.</span><span class='rubyid_collect identifier id'>collect</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_a identifier id'>a</span><span class='bitor op'>|</span> <span class='dstring node'>&quot;#{quote}#{a}#{quote}&quot;</span><span class='rbrace token'>}</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_quote identifier id'>quote</span><span class='dot token'>.</span><span class='rubyid_present? fid id'>present?</span>
  <span class='rubyid_case case kw'>case</span> <span class='rubyid_array identifier id'>array</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span>
    <span class='rubyid_when when kw'>when</span> <span class='integer val'>0</span> <span class='rubyid_then then kw'>then</span> <span class='string val'>&quot;&quot;</span>
    <span class='rubyid_when when kw'>when</span> <span class='integer val'>1</span> <span class='rubyid_then then kw'>then</span> <span class='rubyid_array identifier id'>array</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='rubyid_when when kw'>when</span> <span class='integer val'>2</span> <span class='rubyid_then then kw'>then</span>
      <span class='rubyid_array identifier id'>array</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_ensure_string identifier id'>ensure_string</span> <span class='plus op'>+</span> <span class='rubyid_last_separator identifier id'>last_separator</span><span class='dot token'>.</span><span class='rubyid_ensure_string identifier id'>ensure_string</span> <span class='plus op'>+</span> <span class='rubyid_array identifier id'>array</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_ensure_string identifier id'>ensure_string</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_array identifier id'>array</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='rubyid_array identifier id'>array</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_collect identifier id'>collect</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_e identifier id'>e</span><span class='bitor op'>|</span> <span class='rubyid_e identifier id'>e</span><span class='dot token'>.</span><span class='rubyid_ensure_string identifier id'>ensure_string</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='rubyid_join identifier id'>join</span><span class='lparen token'>(</span><span class='rubyid_separator identifier id'>separator</span><span class='dot token'>.</span><span class='rubyid_ensure_string identifier id'>ensure_string</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='rubyid_last_separator identifier id'>last_separator</span><span class='dot token'>.</span><span class='rubyid_ensure_string identifier id'>ensure_string</span> <span class='plus op'>+</span> <span class='rubyid_array identifier id'>array</span><span class='lbrack token'>[</span><span class='integer val'>-1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_ensure_string identifier id'>ensure_string</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sat Oct  6 08:50:45 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.2.1 (ruby-1.8.7).
</div>

  </body>
</html>